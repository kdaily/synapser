#!/bin/sh

./cleanup

# exit immediately if any step fails
set -e

if [ $(uname -s) = "Linux" ]
then
  echo "Checking system dependencies ..."
  
  check_executable () {
    local dep=$1
    if [ $(which $dep | wc -c) -eq 0 ]
    then
      echo "System dependency not found: $dep"
      exit 1
    fi
  }

  check_library () {
    local dep=$1
    if [ $(ldconfig -p | grep $dep | wc -c) -eq 0 ]
    then
      echo "System dependency not found: $dep"
      exit 1
    fi
  }

  check_package () {
    local dep=$1
    if [ $(dpkg --get-selections | grep $dep | wc -c) -eq 0 ]
    then
      echo "System dependency not found: $dep"
      exit 1
    fi
  }
  
  check_executable dpkg
  check_executable curl

  check_library libssl
  check_library libcurl

  # check_package zlib1g
fi

export PWD_FROM_R=${ALT_PWD-`pwd`}

# This code is for linking the package to the R Python client
Rscript --vanilla tools/installPythonClient.R $PWD_FROM_R

# build the .Rd files
# Note:  We want to just call 'tools/createRdFiles.R .' but it doesn't work on cygwin (Windows)
Rscript --vanilla tools/execCreateRdFiles.R $PWD_FROM_R
